{"module_name":"v.transformer","contents":[{"attributes":{},"comments":[{"text":"\u0001 IndexState is used to track the index analysis performed when parsing the code","is_multi":false,"pos":{"len":80,"line_nr":12,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 `IndexExpr` nodes are annotated with `is_direct`, indicating that the array index can be safely directly accessed.","is_multi":false,"pos":{"len":116,"line_nr":13,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 The c_gen code check will handle this annotation and perform this direct memory access. The following cases are considered valid for this optimisation:","is_multi":false,"pos":{"len":153,"line_nr":15,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 1. the array size is known and has a `len` larger than the index requested","is_multi":false,"pos":{"len":76,"line_nr":16,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 2. the array was previously accessed with a higher value which would have reported the issue already","is_multi":false,"pos":{"len":102,"line_nr":17,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 3. the array was created from a range expression a := range[10..13] and the offset'ed indexes are safe","is_multi":false,"pos":{"len":104,"line_nr":18,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 Current limitations:","is_multi":false,"pos":{"len":22,"line_nr":20,"pos":0,"col":0,"last_line":0}},{"text":"\u0001  * any function using break/continue or goto/label stopped from being optimised as soon as the relevant AST nodes are found as the code can not be ensured to be sequential","is_multi":false,"pos":{"len":173,"line_nr":21,"pos":0,"col":0,"last_line":0}},{"text":"\u0001  * `enum` and `const` indexes are not optimised (they could probably be looked up)","is_multi":false,"pos":{"len":84,"line_nr":22,"pos":0,"col":0,"last_line":0}},{"text":"\u0001  * for loops with multiple var in their init and/or inc are not analysed","is_multi":false,"pos":{"len":74,"line_nr":23,"pos":0,"col":0,"last_line":0}},{"text":"\u0001  * mut array are not analysed as their size can be reduced, but self-assignment in a single line","is_multi":false,"pos":{"len":98,"line_nr":24,"pos":0,"col":0,"last_line":0}}],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\index_state.v","content":"struct IndexState {\nmut:\n\t// max_index has the biggest array index accessed for then named array\n\t// so if a[2] was set or read, it will be 2\n\t// A new array with no .len will recorded as -1 (accessing a[0] would be invalid)\n\t// the value -2 is used to indicate that the array should not be analysed\n\t// this is used for a mut array\n\tmax_index map[string]int\n\t// We need to snapshot when entering `if` and `for` blocks and restore on exit\n\t// as the statements may not be run. This is managed by indent() & unindent().\n\tsaved_disabled []bool\n\tsaved_key_vals [][]KeyVal\npub mut:\n\t// on encountering goto/break/continue statements we stop any analysis\n\t// for the current function (as the code is not linear anymore)\n\tdisabled bool\n\tlevel    int\n}","name":"IndexState","parent_name":"","return_type":"","pos":{"len":21,"line_nr":26,"pos":1257,"col":0,"last_line":43},"platform":"cross","kind":"struct_","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) transform_files(ast_files []&ast.File)","name":"transform_files","parent_name":"Transformer","return_type":"void","pos":{"len":65,"line_nr":39,"pos":804,"col":0,"last_line":44},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) transform(mut ast_file ast.File)","name":"transform","parent_name":"Transformer","return_type":"void","pos":{"len":59,"line_nr":46,"pos":971,"col":0,"last_line":51},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) find_new_array_len(node ast.AssignStmt)","name":"find_new_array_len","parent_name":"Transformer","return_type":"void","pos":{"len":66,"line_nr":53,"pos":1118,"col":0,"last_line":83},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) find_new_range(node ast.AssignStmt)","name":"find_new_range","parent_name":"Transformer","return_type":"void","pos":{"len":62,"line_nr":85,"pos":1802,"col":0,"last_line":115},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) find_mut_self_assign(node ast.AssignStmt)","name":"find_mut_self_assign","parent_name":"Transformer","return_type":"void","pos":{"len":68,"line_nr":117,"pos":2544,"col":0,"last_line":122},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) check_safe_array(mut node ast.IndexExpr)","name":"check_safe_array","parent_name":"Transformer","return_type":"void","pos":{"len":67,"line_nr":124,"pos":2713,"col":0,"last_line":173},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) stmt(mut node ast.Stmt) ast.Stmt","name":"stmt","parent_name":"Transformer","return_type":"v.ast.Stmt","pos":{"len":59,"line_nr":175,"pos":3816,"col":0,"last_line":294},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) assert_stmt(mut node ast.AssertStmt) ast.Stmt","name":"assert_stmt","parent_name":"Transformer","return_type":"v.ast.Stmt","pos":{"len":72,"line_nr":296,"pos":6330,"col":0,"last_line":351},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) expr_stmt_if_expr(mut node ast.IfExpr) ast.Expr","name":"expr_stmt_if_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":74,"line_nr":353,"pos":7552,"col":0,"last_line":396},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) expr_stmt_match_expr(mut node ast.MatchExpr) ast.Expr","name":"expr_stmt_match_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":80,"line_nr":398,"pos":8836,"col":0,"last_line":467},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) for_c_stmt(mut node ast.ForCStmt) ast.Stmt","name":"for_c_stmt","parent_name":"Transformer","return_type":"v.ast.Stmt","pos":{"len":69,"line_nr":469,"pos":10266,"col":0,"last_line":491},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) for_stmt(mut node ast.ForStmt) ast.Stmt","name":"for_stmt","parent_name":"Transformer","return_type":"v.ast.Stmt","pos":{"len":66,"line_nr":493,"pos":10773,"col":0,"last_line":515},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) interface_decl(mut node ast.InterfaceDecl) ast.Stmt","name":"interface_decl","parent_name":"Transformer","return_type":"v.ast.Stmt","pos":{"len":78,"line_nr":517,"pos":11271,"col":0,"last_line":523},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) expr(mut node ast.Expr) ast.Expr","name":"expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":59,"line_nr":525,"pos":11458,"col":0,"last_line":703},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) call_expr(mut node ast.CallExpr) ast.Expr","name":"call_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":68,"line_nr":705,"pos":15479,"col":0,"last_line":710},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) infix_expr(mut node ast.InfixExpr) ast.Expr","name":"infix_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":70,"line_nr":744,"pos":16674,"col":0,"last_line":1000},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) if_expr(mut node ast.IfExpr) ast.Expr","name":"if_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":64,"line_nr":1002,"pos":22214,"col":0,"last_line":1039},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) match_expr(mut node ast.MatchExpr) ast.Expr","name":"match_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":70,"line_nr":1041,"pos":23044,"col":0,"last_line":1078},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) sql_expr(mut node ast.SqlExpr) ast.Expr","name":"sql_expr","parent_name":"Transformer","return_type":"v.ast.Expr","pos":{"len":66,"line_nr":1080,"pos":23846,"col":0,"last_line":1101},"platform":"cross","kind":"method","public":true,"from_scope":false},{"attributes":{},"comments":[{"text":"\u0001 fn_decl mutates `node`.","is_multi":false,"pos":{"len":25,"line_nr":1103,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 if `pref.trace_calls` is true ast Nodes for `eprintln(...)` is prepended to the `FnDecl`'s","is_multi":false,"pos":{"len":92,"line_nr":1104,"pos":0,"col":0,"last_line":0}},{"text":"\u0001 stmts list to let the gen backend generate the target specific code for the print.","is_multi":false,"pos":{"len":84,"line_nr":1105,"pos":0,"col":0,"last_line":0}}],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn (mut t Transformer) fn_decl(mut node ast.FnDecl)","name":"fn_decl","parent_name":"Transformer","return_type":"void","pos":{"len":55,"line_nr":1106,"pos":24660,"col":0,"last_line":1142},"platform":"cross","kind":"method","public":true,"from_scope":false}],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"struct Transformer {\n\tpref &pref.Preferences\npub mut:\n\tindex &IndexState\n\ttable &ast.Table = unsafe { nil }\n\tfile  &ast.File  = unsafe { nil }\nmut:\n\tis_assert   bool\n\tinside_dump bool\n}","name":"Transformer","parent_name":"","return_type":"","pos":{"len":22,"line_nr":6,"pos":62,"col":0,"last_line":15},"platform":"cross","kind":"struct_","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn new_transformer(pref_ &pref.Preferences) &Transformer","name":"new_transformer","parent_name":"","return_type":"Transformer","pos":{"len":60,"line_nr":23,"pos":410,"col":0,"last_line":31},"platform":"cross","kind":"function","public":true,"from_scope":false},{"attributes":{},"comments":[],"children":[],"tags":[],"file_path":"D:\\Games\\Proekti\\V\\v\\vlib\\v\\transformer\\transformer.v","content":"fn new_transformer_with_table(table &ast.Table, pref_ &pref.Preferences) &Transformer","name":"new_transformer_with_table","parent_name":"","return_type":"Transformer","pos":{"len":89,"line_nr":33,"pos":619,"col":0,"last_line":37},"platform":"cross","kind":"function","public":true,"from_scope":false}],"generator":"vdoc","time_generated":"2024-02-05 19:45:43"}